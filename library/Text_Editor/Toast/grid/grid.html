<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>grid01</title>
      <!-- ğŸ“¦ Toast UI Editor -->
      <link
         rel="stylesheet"
         href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css"
      />
      <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

      <!-- ğŸ“¦ Toast UI Grid -->
      <link
         rel="stylesheet"
         href="https://uicdn.toast.com/grid/latest/tui-grid.css"
      />
      <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
   </head>
   <body>
      <h3>ğŸ“ ì—ë””í„°</h3>
      <div id="editor"></div>

      <button onclick="renderGrid()">ğŸ“Š ê·¸ë¦¬ë“œ ë Œë”ë§</button>

      <h3>ğŸ“‹ Toast Grid</h3>
      <div id="grid" style="margin-top: 20px"></div>

      <script>
         let grid; // ğŸ”¹ ì „ì—­ Grid ì¸ìŠ¤í„´ìŠ¤
         const text = [
            { name: 'í™ê¸¸ë™', age: 30, job: 'ê°œë°œì' },
            { name: 'ê¹€ì˜í¬', age: 25, job: 'ë””ìì´ë„ˆ' },
         ];

         const text2 = `| ì´ë¦„   | ë‚˜ì´ | ì§ì—…     |
|--------|------|----------|
| í™ê¸¸ë™ | 30   | ê°œë°œì   |
| ê¹€ì˜í¬ | 25   | ë””ìì´ë„ˆ |
| ì´ìˆœì‹  | 40   | ê¸°íšì   |
`;

         const editor = new toastui.Editor({
            el: document.querySelector('#editor'),
            height: '300px',
            initialEditType: 'markdown',
            previewStyle: 'vertical',
            initialValue: text2,
         });

         const columns = [
            { header: 'ì´ë¦„', name: 'name' },
            { header: 'ë‚˜ì´', name: 'age' },
            { header: 'ì§ì—…', name: 'job' },
         ];

         window.addEventListener('DOMContentLoaded', () => {
            grid = new tui.Grid({
               el: document.getElementById('grid'),
               data: [],
               columns: [
                  {
                     header: 'ì´ë¦„',
                     name: 'name',
                  },
                  {
                     header: 'ë‚˜ì´',
                     name: 'age',
                     editor: 'text',
                  },
                  {
                     header: 'ì§ì—…',
                     name: 'job',
                  },
               ],
               bodyHeight: 200,
            });
         });

         /*function renderGrid() {
            const content = editor.getMarkdown();
            let data;

            try {
               data = JSON.parse(content);
            } catch (e) {
               alert('ì—ë””í„° ë‚´ìš©ì´ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
               return;
            }

            if (!grid) {
               alert('Grid ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
               return;
            }

            // âœ… ê¸°ì¡´ Gridì— ë°ì´í„°ë§Œ ê°±ì‹ 
            grid.resetData(data);
         }*/

         // 3. ë§ˆí¬ë‹¤ìš´ í…Œì´ë¸” íŒŒì‹± í•¨ìˆ˜
         function parseMarkdownTable(md) {
            const lines = md
               .trim()
               .split('\n')
               .filter((line) => line.startsWith('|'));
            if (lines.length < 2) return { columns: [], data: [] };

            const header = lines[0]
               .split('|')
               .map((cell) => cell.trim())
               .filter((cell) => cell);
            const columns = header.map((col) => ({ header: col, name: col }));

            const data = lines.slice(2).map((line) => {
               const cells = line
                  .split('|')
                  .map((cell) => cell.trim())
                  .filter((cell) => cell);
               const row = {};
               header.forEach((key, idx) => {
                  row[key] = cells[idx] || '';
               });
               return row;
            });

            return { columns, data };
         }

         // 4. ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
         function renderGrid() {
            const markdown = editor.getMarkdown();
            const { columns, data } = parseMarkdownTable(markdown);

            if (columns.length === 0 || data.length === 0) {
               alert('ë§ˆí¬ë‹¤ìš´ í…Œì´ë¸” í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šê±°ë‚˜ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
               return;
            }

            // ê¸°ì¡´ ì»¬ëŸ¼/ë°ì´í„° ì¬ì„¤ì •
            grid.setColumns(columns);
            grid.resetData(data);
         }
      </script>
   </body>
</html>
